# 통합 개발 및 매니지먼트 규정 (Strict Protocol)

본 규정은 모델 간의 맥락 공유를 최적화하고, 설계 기반의 고품질 코드를 생산하기 위한 **절대 원칙**입니다. 모든 작업은 이 가이드를 최우선으로 따릅니다.

---

## 1. 필수 컨텍스트 관리 (Source of Truth)
모든 작업 전/후에는 아래 파일들을 반드시 참조하고 최신 상태로 유지해야 합니다.
- **`docs/ai-context/status.md`**: 현재 진행 중인 태스크 및 전체 진행률 요약.
- **`docs/ai-context/decision_log.md`**: 아키텍처 선택, 라이브러리 도입 등 주요 결정 사항 및 이유(Why) 기록.
- **`docs/ai-context/todo.md`**: 구체적인 하위 작업 목록 및 완료(`[x]`) 여부.

---

## 2. 작업 단계별 프로세스

### [단계 1] 요구사항 분석 및 스코핑 (Scoping)
1. **코드베이스 분석**: Serena MCP를 사용하여 관련 심볼(`get_symbols_overview`), 수정 대상(`find_symbol`), 영향 범위(`find_referencing_symbols`)를 파악한다.
2. **명확화 (Clarification)**: 엣지 케이스, 최종 결과물의 모습, 성공 기준이 불명확하면 **반드시 사용자에게 질문**하여 정의한다.
3. **이슈 작성**: 명확화가 끝나면 GitHub Issue를 상세히 작성한다.
   - **Acceptance Criteria (AC)**를 최상단에 배치 (Given/When/Then 형식 권장).
   - 배경, 변경 범위, 구현 방향, 테스트 계획을 포함한다.

### [단계 2] 작업 분배 및 실행 (Orchestration)
1. **병렬화 판단**: 이슈 간 의존성을 분석하여 병렬 실행 가능 여부를 판단한다.
2. **Worktree 활용**: 병렬 작업 시 `git worktree`를 분리하여 독립적으로 실행한다.
3. **원자적 수정**: 한 번에 하나의 기능(심볼)만 수정하며, Serena MCP의 `replace_symbol_body` 등을 활용해 문법 오류를 방지한다. **파일 전체 읽기/쓰기는 엄격히 금지**한다.

### [단계 3] 검증 및 테스트 (Verification)
1. **시각적 검증 필수**: UI 작업은 반드시 `chrome-extention` 혹은 `playwright-mcp`의 `screenshot` 기능을 사용해 실제 렌더링을 눈으로 확인한다. (DOM 트리나 로그만 보고 판단 금지)
2. **테스트 수행**: 기존 테스트 통과 및 신규 기능 테스트를 추가한다. 스크린샷과 로그는 `.playwright-mcp`에 기록한다.
3. **셀프 리뷰**: PR 생성 전 목표 달성 여부, 스코프 이탈, 보안 취약점(OWASP), 기존 컨벤션 준수 여부를 스스로 체크한다.

### [단계 4] 작업 종료 및 기록 업데이트 (Closing)
1. **사용자 가이드**: 사용자가 직접 테스트할 수 있도록 실행 방법과 확인 포인트를 정리하여 전달한다.
2. **컨텍스트 동기화**: `status.md`, `todo.md`, `decision_log.md`를 업데이트한다.
3. **정리**: 머지 후 관련 이슈를 닫고, 사용한 worktree와 브랜치를 삭제한다.

---

## 3. 기술 및 디자인 원칙

### 디자인 규칙 (8-Grid System)
- **8px 그리드**: 모든 간격과 크기는 8의 배수를 지향한다.
- **일관성**: 동일한 Radius와 그림자 단계를 유지한다.
- **컬러/타이포**: 컬러는 5개 이하로 제한하고 여백을 충분히 활용한다.
- **애니메이션**: 200~300ms 준수.
- **보라색 네온 그라데이션 사용 금지.**

### 코드 스타일 및 에러 핸들링
- 프로젝트의 기존 컨벤션을 따르며, 시스템 바운더리(입력값, 외부 API)에서만 엄격히 검증한다.
- 발생할 수 없는 시나리오에 대한 과도한 방어 코드는 지양한다.
- 새 의존성 추가 시 `decision_log.md`에 반드시 사유를 기록한다.

### 커밋 및 브랜치 전략
- **Conventional Commits**: `feat:`, `fix:`, `refactor:`, `test:`, `docs:`, `chore:` 사용.
- **한글 작성**: 커밋 메시지와 모든 기록은 한글로 간결하게 작성한다.
- **브랜치명**: `{type}/issue-{번호}-{설명}` 형식을 준수한다. (메인 브랜치 직접 커밋 금지)

---

## 4. Serena MCP 사용 상세 규칙
1. **탐색 우선**: `overview` → `symbol` → `edit` 순서를 준수한다.
2. **토큰 절약**: 필요한 심볼만 골라 읽으며 **절대 파일 전체를 읽지 않는다.**
3. **수정 방식**: 문자열 기반 편집을 지양하고 심볼 단위(`replace_symbol_body`)로 수정한다.

---
**주의:** 이 규칙을 무시하고 코드를 수정할 경우, 해당 작업은 무효로 간주됩니다. 항상 기록을 먼저 확인하고 작업 종료 후 업데이트를 완료하세요.