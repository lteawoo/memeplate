# Memeplate 개발 TODO

## 자체 엔진 기능 고도화 [Completed]
- [x] **컨트롤 인터랙션**
  - [x] 8방향 리사이즈 핸들
  - [x] 회전 핸들 (MTR)
  - [x] 마우스 커서 피드백 (move, resize, crosshair)
  - [x] 리사이즈 UX 표준화 (코너 자유변형, 엣지 단일 축)
  - [x] 단축키 modifier(`Shift`, `Alt/Option`) 동작은 스펙 제외
  - [x] 회전 핸들(MTR) 히트 테스트 좌표 보정
  - [x] 툴바 컴팩트화 1차 (`이미지/편집/공유` 높이/패딩/여백 축소)
  - [x] 레이어 텍스트 편집 2단 레이아웃 적용(입력칸 가로폭 확장)
- [x] **텍스트 레이어 정립**
  - [x] 자동 줄바꿈 (Word Wrap)
  - [x] 고정 틀(Fixed Container) 방식: 내용 변경 시 크기 유지
  - [x] 리사이즈 시 fontSize 보존 (Scale 대신 Width/Height 조절)
  - [x] 세로 정렬: 상단(Top) 고정
- [x] **렌더링 시스템 최적화**
  - [x] Dirty Flag (`needsRedraw`) 기반 렌더링 루프
  - [x] 비동기 이미지 로딩 대응 (로딩 중 자동 재렌더링)
  - [x] 캔버스 마진 제거 및 좌표계 최적화
  - [x] 이벤트 중복 실행 방지 및 리소스 정리(Cleanup) 로직 구현

## 향후 과제
- [x] **텍스트 더블 클릭 편집 (#29)**
  - [x] `Canvas.ts`: `dblclick` 브라우저 이벤트 리스너 추가 및 커스텀 이벤트 발생
  - [x] `useMemeEditor.ts`: `editingTextId` 상태 및 더블 클릭 핸들러 추가
  - [x] `MemeCanvas.tsx`: 캔버스 상단에 동적 textarea 오버레이 구현
  - [x] 텍스트 스타일(폰트 크기, 정렬 등) 동기화 로직 정교화
- [x] **텍스트 더블클릭 편집 UX 보강**
  - [x] `MemeCanvas.tsx`: 편집 textarea 대비(배경/그림자/보더/캐럿) 강화
  - [x] `MemeCanvas.tsx`: 편집 폰트 크기를 텍스트 박스 fit 결과와 동기화
  - [x] `MemeCanvas.tsx`: `Ctrl/Cmd + Enter` 저장, `Esc` 취소/원복 추가
  - [x] `MemePropertyPanel.tsx`: 레이어 텍스트 입력을 `Input.TextArea`로 변경(최대 3줄)
  - [x] `MemeCanvas.tsx`: 캔버스 중앙정렬 레이아웃에서 편집 textarea 위치 계산에 캔버스 오프셋 보정
- [x] **텍스트 레이아웃 공통화 (WYSIWYG 개선)**
  - [x] `core/canvas/textLayout.ts` 공통 레이아웃 유틸 추가
  - [x] `Textbox.ts` 렌더에서 공통 레이아웃 계산 재사용
  - [x] `MemeCanvas.tsx` 편집 오버레이 폰트/세로 정렬 계산에서 공통 로직 재사용
- [x] **텍스트 레이어 기본값/placeholder 정리**
  - [x] `useMemeEditor.ts`: 새 텍스트 레이어 기본 문자열 제거(빈 텍스트 생성)
  - [x] `MemePropertyPanel.tsx`: 텍스트 레이어 입력 placeholder를 `텍스트-{순번}`으로 표시
- [x] **캔버스 표시/줌 UX 개선 (#30)**
  - [x] `useMemeEditor.ts`: 업로드 시 캔버스 논리 크기를 원본 해상도 기준으로 설정
  - [x] `MemeCanvas.tsx`: `Fit`/`100%` 토글 및 줌 퍼센트 표시 추가
  - [x] `MemeCanvas.tsx`: `Ctrl/Cmd + 0` 단축키로 `Fit` 복귀 지원
  - [x] `MemeEditor.tsx`: `workspaceSize` 전달로 표시 스케일 연동
- [x] **린트 경고 정리 (#33)**
  - [x] `useMemeEditor.ts`: Undo/Redo 키보드 effect 의존성 경고 제거
  - [x] `useMemeEditor.ts`: 이벤트/업로드 파라미터의 `any` 타입 제거
  - [x] `useMemeEditor.ts`: 미사용 에러 변수 정리 및 타입 캐스팅 정리
- [x] **텍스트 렌더 품질 개선 (#37)**
  - [x] `Canvas.ts`: render scale/backing store 동기화 로직 추가
  - [x] `MemeCanvas.tsx`: 표시 배율 연동 `setRenderScale` 적용
  - [x] `MemeCanvas.tsx`: 편집 textarea의 폰트/정렬/스타일 동기화
- [x] **줌 UX 고도화 (#39)**
  - [x] `MemeEditor.tsx`: `fit/manual` 줌 상태 및 `- / + / 퍼센트 입력` 컨트롤 추가
  - [x] `MemeCanvas.tsx`: 수동 줌 퍼센트 기반 표시 스케일 계산 추가
  - [x] `MemeCanvas.tsx`: `Ctrl/Cmd + Wheel` 연속 줌 이벤트 연결
  - [x] `MemeCanvas.tsx`: Auto Fit 스케일 상한(100%) 적용으로 과확대 방지
  - [x] `MemeCanvas.tsx`: 화면/원본 비율에 따른 Auto Fit 가변 상한(1.1/1.25/1.4) 적용
  - [x] `MemeEditor.tsx`: 줌 UI 요소 제거(버튼/입력)
  - [x] `MemeCanvas.tsx`: Auto Fit 단일 스케일 계산으로 단순화
  - [x] `MemeEditor.tsx`: `Fit`/`100%` 컨트롤 및 퍼센트 표시 복원
  - [x] `MemeCanvas.tsx`: `fit/actual` 표시 모드 재연결 및 기본 `fit` 복구
  - [x] `MemeEditor.tsx`: 줌 퍼센트 표시 제거
  - [x] `MemeCanvas.tsx`: Auto Fit 가변 상한 제거 및 순수 Fit 비율 복원
  - [x] `MemeEditor.tsx`: `workspaceSize` 변경 시 `zoomMode`를 `fit`으로 자동 복귀
  - [x] `EditorLayout.tsx`/`MemeEditor.tsx`/`MemeCanvas.tsx`: `min-w-0` 추가로 대형 캔버스가 레이아웃 폭을 밀어내는 문제 수정
  - [x] `MemeCanvas.tsx`: `fit` 모드 표시 크기를 floor 계산으로 변경해 비클리핑 보장 강화
- [x] **줌 정책 단순화 (Fit/100% 제거 + 최대 px 자동 스케일)**
  - [x] `MemeEditor.tsx`: `zoomMode` 상태 및 `Fit`/`100%` 버튼 제거
  - [x] `MemeCanvas.tsx`: 단일 `displayScale` 계산으로 통합
  - [x] `MemeCanvas.tsx`: 최대 표시 변 길이 `800px` 상한 적용
- [x] **고정 크기 조절점 (#27)**
  - [x] `Canvas.ts`: 화면 배율 역보정 로직 (`getSceneScale`) 도입
  - [x] `Canvas.ts`: `drawControls` 핸들 크기 및 선 두께 보정
  - [x] `Canvas.ts`: `findControl` 터치 영역 배율 대응
- [x] **모바일 레이아웃 개편 (#25)**
  - [x] `MemeEditor.tsx`: 모바일 전용 오버레이(`fixed`) 제거 및 세로 배치 로직 구현
  - [x] `EditorLayout.tsx`: 모바일에서의 `flex-col` 및 `overflow` 속성 조정
  - [x] `MemeCanvas.tsx`: 모바일 스크롤 환경에 맞는 높이 최적화
  - [x] `useMemeEditor.ts`: 패널 상태(`isPanelOpen`) 관련 불필요한 로직 제거
- [x] **텍스트 외곽선 강도 기반 UI/렌더 전환**
  - [x] `MemePropertyPanel.tsx`: 외곽선 입력/슬라이더 단위를 `px`에서 `강도`로 변경 (`0~10`)
  - [x] `Textbox.ts`: `strokeWidth`를 폰트 크기 비례 실제 선 두께(px)로 변환해 렌더링
- [ ] **에디터 기능 확장**
  - [ ] 텍스트 영역 클리핑 (틀 밖으로 나가는 글자 숨김)
  - [ ] 다중 선택(Multi-selection) 지원
  - [ ] 그룹화(Grouping) 기능
- [ ] **시스템 고도화**
  - [x] API 보안 하드닝 1차 (`helmet`, `rate-limit`, 이미지 프록시 제거)
  - [x] 프론트 상태관리 1차 (`zustand` auth store, React Query 목록 캐시)
  - [ ] 웹 워커(Web Worker) 기반 내보내기 처리
  - [ ] Undo/Redo 로직 정밀화

## 백엔드 도입 (Fastify) [In Progress]
- [x] **1차 스캐폴딩**
  - [x] `server/` 패키지 초기화 (`Fastify + TS + Zod`)
  - [x] API 진입점 및 라우트 모듈 생성 (`health`, `auth`, `templates`)
  - [x] 환경변수 스키마 및 `.env.example` 추가
  - [x] 루트 스크립트 연결 (`npm run dev:api`, `npm run build:api`)
- [x] **1.1 환경설정/헬스체크 정리**
  - [x] `.env.development` / `.env.production` 분리 로딩 구현
  - [x] `apps/api/.env.development.example`, `apps/api/.env.production.example` 추가
  - [x] `GET /healthz` 엔드포인트 추가
  - [x] 헬스체크 URL 수동 검증 (`/healthz`, `/api/v1/health`)
- [x] **1.2 pnpm 모노레포 전환**
  - [x] 워크스페이스 경로를 `apps/web`, `apps/api`로 재구성
  - [x] 루트 `package.json`을 workspace 오케스트레이터로 전환
  - [x] `pnpm-workspace.yaml` 및 `pnpm-lock.yaml` 추가
  - [x] `package-lock.json` 계열 제거
  - [x] `apps/api/README.md` 경로/실행 명령 갱신
- [x] **1.3 프로덕션 배포 경로 통합**
  - [x] API 서버에서 SPA 정적 서빙(`@fastify/static`) 구현
  - [x] `WEB_DIST_DIR` 환경변수 추가 및 example 반영
  - [x] SPA fallback 라우트(`/* -> index.html`, `/api*` 제외) 구현
  - [x] 프로덕션 모드 수동 검증 (`/`, `/create`, `/api/v1/health`)
- [ ] **2차 인증 구현**
  - [x] Supabase 인증 스키마(SQL) 초안 작성 (`docs/ai-context/sql/2026-02-14_supabase_auth_schema.sql`)
  - [x] Google OAuth start/callback 라우트 구현
  - [x] JWT(access/refresh) 쿠키 발급/검증/회전 구현
  - [x] `POST /api/v1/auth/refresh` API 구현
  - [x] 공통 인증 미들웨어(`requireAuth`) 구현 및 밈플릿 라우트 적용
  - [x] `MainHeader` 로그인/로그아웃 UI 및 세션 상태 표시 연동
  - [x] 우측 상단 사용자 이름 메뉴(마이페이지/내 밈플릿/로그아웃) 연결
  - [x] `마이페이지(/my)` 화면 추가
  - [x] `/my`, `/my/templates` 공통 좌측 사이드 메뉴 레이아웃 적용
  - [x] `/login` 페이지 추가 (Memeplate 로고 + 하단 구글 로그인 버튼)
  - [ ] Supabase SQL 실행 및 초기 데이터 검증
- [ ] **3차 밈플릿 도메인 구현**
  - [x] `TemplateRepository` Supabase 구현체 추가
  - [x] 내 밈플릿 조회/등록/수정/삭제 API 구현
  - [x] 공개 밈플릿 목록 API 구현 (`GET /templates/public`)
  - [x] 공개 목록 지표 필드 응답 추가 (`viewCount`, `likeCount`)
  - [x] 공유 slug 상세 조회 API 구현 (`GET /templates/s/:shareSlug`)
  - [x] 에디터 공유 탭 API 연동(저장/업데이트/공유링크복사)
  - [x] 공개 밈플릿 시작 경로(`shareSlug`)에서 배경 미복원 케이스 fallback 처리(썸네일 기반 background 객체 주입)
  - [x] 공개 밈플릿 시작 시 기본 활성 도구를 `편집`으로 설정
  - [x] 썸네일 payload 최적화(긴 변 `1280px` 리사이즈 + `webp` 품질 압축)
  - [ ] 밈플릿 목록/관리 전용 화면 구현 (`/templates`, `/my/templates`)
