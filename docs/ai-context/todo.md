# Memeplate 개발 TODO

## 자체 엔진 기능 고도화 [Completed]
- [x] **컨트롤 인터랙션**
  - [x] 8방향 리사이즈 핸들
  - [x] 회전 핸들 (MTR)
  - [x] 마우스 커서 피드백 (move, resize, crosshair)
  - [x] 리사이즈 UX 표준화 (코너 자유변형, 엣지 단일 축)
  - [x] 단축키 modifier(`Shift`, `Alt/Option`) 동작은 스펙 제외
  - [x] 회전 핸들(MTR) 히트 테스트 좌표 보정
  - [x] 툴바 컴팩트화 1차 (`이미지/편집/공유` 높이/패딩/여백 축소)
  - [x] 레이어 텍스트 편집 2단 레이아웃 적용(입력칸 가로폭 확장)
- [x] **텍스트 레이어 정립**
  - [x] 자동 줄바꿈 (Word Wrap)
  - [x] 고정 틀(Fixed Container) 방식: 내용 변경 시 크기 유지
  - [x] 리사이즈 시 fontSize 보존 (Scale 대신 Width/Height 조절)
  - [x] 세로 정렬: 상단(Top) 고정
- [x] **렌더링 시스템 최적화**
  - [x] Dirty Flag (`needsRedraw`) 기반 렌더링 루프
  - [x] 비동기 이미지 로딩 대응 (로딩 중 자동 재렌더링)
  - [x] 캔버스 마진 제거 및 좌표계 최적화
  - [x] 이벤트 중복 실행 방지 및 리소스 정리(Cleanup) 로직 구현

## 향후 과제
- [x] **텍스트 더블 클릭 편집 (#29)**
  - [x] `Canvas.ts`: `dblclick` 브라우저 이벤트 리스너 추가 및 커스텀 이벤트 발생
  - [x] `useMemeEditor.ts`: `editingTextId` 상태 및 더블 클릭 핸들러 추가
  - [x] `MemeCanvas.tsx`: 캔버스 상단에 동적 textarea 오버레이 구현
  - [x] 텍스트 스타일(폰트 크기, 정렬 등) 동기화 로직 정교화
- [x] **텍스트 더블클릭 편집 UX 보강**
  - [x] `MemeCanvas.tsx`: 편집 textarea 대비(배경/그림자/보더/캐럿) 강화
  - [x] `MemeCanvas.tsx`: 편집 폰트 크기를 텍스트 박스 fit 결과와 동기화
  - [x] `MemeCanvas.tsx`: `Ctrl/Cmd + Enter` 저장, `Esc` 취소/원복 추가
  - [x] `MemePropertyPanel.tsx`: 레이어 텍스트 입력을 `Input.TextArea`로 변경(최대 3줄)
  - [x] `MemeCanvas.tsx`: 캔버스 중앙정렬 레이아웃에서 편집 textarea 위치 계산에 캔버스 오프셋 보정
- [x] **텍스트 레이아웃 공통화 (WYSIWYG 개선)**
  - [x] `core/canvas/textLayout.ts` 공통 레이아웃 유틸 추가
  - [x] `Textbox.ts` 렌더에서 공통 레이아웃 계산 재사용
  - [x] `MemeCanvas.tsx` 편집 오버레이 폰트/세로 정렬 계산에서 공통 로직 재사용
  - [x] 긴 단어/무공백 문자열 문자 단위 줄바꿈 fallback 추가(특정 크기에서 텍스트 소실 체감 보정)
  - [x] 최대 폰트 크기 탐색을 실제 fit 지점까지 보정(100회 제한 제거)
- [x] **텍스트 레이어 기본값/placeholder 정리**
  - [x] `useMemeEditor.ts`: 새 텍스트 레이어 기본 문자열 제거(빈 텍스트 생성)
  - [x] `MemePropertyPanel.tsx`: 텍스트 레이어 입력 placeholder를 `텍스트-{순번}`으로 표시
- [x] **캔버스 표시/줌 UX 개선 (#30)**
  - [x] `useMemeEditor.ts`: 업로드 시 캔버스 논리 크기를 원본 해상도 기준으로 설정
  - [x] `MemeCanvas.tsx`: `Fit`/`100%` 토글 및 줌 퍼센트 표시 추가
  - [x] `MemeCanvas.tsx`: `Ctrl/Cmd + 0` 단축키로 `Fit` 복귀 지원
  - [x] `MemeEditor.tsx`: `workspaceSize` 전달로 표시 스케일 연동
- [x] **린트 경고 정리 (#33)**
  - [x] `useMemeEditor.ts`: Undo/Redo 키보드 effect 의존성 경고 제거
  - [x] `useMemeEditor.ts`: 이벤트/업로드 파라미터의 `any` 타입 제거
  - [x] `useMemeEditor.ts`: 미사용 에러 변수 정리 및 타입 캐스팅 정리
- [x] **텍스트 렌더 품질 개선 (#37)**
  - [x] `Canvas.ts`: render scale/backing store 동기화 로직 추가
  - [x] `MemeCanvas.tsx`: 표시 배율 연동 `setRenderScale` 적용
  - [x] `MemeCanvas.tsx`: 편집 textarea의 폰트/정렬/스타일 동기화
- [x] **줌 UX 고도화 (#39)**
  - [x] `MemeEditor.tsx`: `fit/manual` 줌 상태 및 `- / + / 퍼센트 입력` 컨트롤 추가
  - [x] `MemeCanvas.tsx`: 수동 줌 퍼센트 기반 표시 스케일 계산 추가
  - [x] `MemeCanvas.tsx`: `Ctrl/Cmd + Wheel` 연속 줌 이벤트 연결
  - [x] `MemeCanvas.tsx`: Auto Fit 스케일 상한(100%) 적용으로 과확대 방지
  - [x] `MemeCanvas.tsx`: 화면/원본 비율에 따른 Auto Fit 가변 상한(1.1/1.25/1.4) 적용
  - [x] `MemeEditor.tsx`: 줌 UI 요소 제거(버튼/입력)
  - [x] `MemeCanvas.tsx`: Auto Fit 단일 스케일 계산으로 단순화
  - [x] `MemeEditor.tsx`: `Fit`/`100%` 컨트롤 및 퍼센트 표시 복원
  - [x] `MemeCanvas.tsx`: `fit/actual` 표시 모드 재연결 및 기본 `fit` 복구
  - [x] `MemeEditor.tsx`: 줌 퍼센트 표시 제거
  - [x] `MemeCanvas.tsx`: Auto Fit 가변 상한 제거 및 순수 Fit 비율 복원
  - [x] `MemeEditor.tsx`: `workspaceSize` 변경 시 `zoomMode`를 `fit`으로 자동 복귀
  - [x] `EditorLayout.tsx`/`MemeEditor.tsx`/`MemeCanvas.tsx`: `min-w-0` 추가로 대형 캔버스가 레이아웃 폭을 밀어내는 문제 수정
  - [x] `MemeCanvas.tsx`: `fit` 모드 표시 크기를 floor 계산으로 변경해 비클리핑 보장 강화
- [x] **줌 정책 단순화 (Fit/100% 제거 + 최대 px 자동 스케일)**
  - [x] `MemeEditor.tsx`: `zoomMode` 상태 및 `Fit`/`100%` 버튼 제거
  - [x] `MemeCanvas.tsx`: 단일 `displayScale` 계산으로 통합
  - [x] `MemeCanvas.tsx`: 최대 표시 변 길이 `800px` 상한 적용
- [x] **고정 크기 조절점 (#27)**
  - [x] `Canvas.ts`: 화면 배율 역보정 로직 (`getSceneScale`) 도입
  - [x] `Canvas.ts`: `drawControls` 핸들 크기 및 선 두께 보정
  - [x] `Canvas.ts`: `findControl` 터치 영역 배율 대응
- [x] **모바일 레이아웃 개편 (#25)**
  - [x] `MemeEditor.tsx`: 모바일 전용 오버레이(`fixed`) 제거 및 세로 배치 로직 구현
  - [x] `EditorLayout.tsx`: 모바일에서의 `flex-col` 및 `overflow` 속성 조정
  - [x] `MemeCanvas.tsx`: 모바일 스크롤 환경에 맞는 높이 최적화
  - [x] `useMemeEditor.ts`: 패널 상태(`isPanelOpen`) 관련 불필요한 로직 제거
- [x] **텍스트 외곽선 강도 기반 UI/렌더 전환**
  - [x] `MemePropertyPanel.tsx`: 외곽선 입력/슬라이더 단위를 `px`에서 `강도`로 변경 (`0~10`)
  - [x] `Textbox.ts`: `strokeWidth`를 폰트 크기 비례 실제 선 두께(px)로 변환해 렌더링
- [ ] **에디터 기능 확장**
  - [x] 텍스트 영역 클리핑 (틀 밖으로 나가는 글자 숨김)
  - [ ] 다중 선택(Multi-selection) 지원
  - [ ] 그룹화(Grouping) 기능
- [ ] **시스템 고도화**
  - [x] API 보안 하드닝 1차 (`helmet`, `rate-limit`, 이미지 프록시 제거)
  - [x] 프론트 상태관리 1차 (`zustand` auth store, React Query 목록 캐시)
  - [x] 공개 목록 API 작성자명 조회 1쿼리화 (`templates`, `meme_images`)
  - [x] 조회수 증가 API 원자 업데이트 적용 (DB 함수 + RPC 전환)
  - [x] 공유 탭 UI 정합화 (`리믹스 게시` 카드 디자인 통일 + 사이드패널 스크롤 보강)
  - [x] Undo/Redo 히스토리 저장 디바운스 1차 (`updateProperty` 200ms coalescing)
  - [x] 템플릿 배경 DataURL -> R2 URL 저장 전환 1차 (`backgroundDataUrl` 업로드/치환)
  - [x] 밈플릿/리믹스 게시 포맷 `webp` 정렬 + 다운로드 기본 포맷 `png` 유지
  - [x] 리믹스 게시 해상도 보정 (`multiplier: 2` 적용)
  - [x] 공유 탭 게시 액션 모달화 (`밈플릿 게시`, `리믹스 게시`)
  - [x] 템플릿 업데이트 시 배경 무변경이면 R2 재업로드 스킵 (재인코딩 방지)
  - [x] 대형 원본 업로드 시 작업영역 자동 축소(`max edge 8192`)로 클리핑 방지
  - [x] 캔버스 리사이즈 재계산 파이프라인 보정(usable area + border 반영)
  - [x] 모바일 무한 리사이즈 루프 대응 1차(`h-dvh` + `min-h-0`) 실험 후 롤백
  - [x] 모바일 회귀 대응: 레이아웃 실험 롤백 + 로컬 업로드 `blob URL` 경량화
  - [x] 모바일 리사이즈 정책 2차: width-fit 우선 + 높이 상한 제거
  - [x] 리사이즈 기준 분리 3차: 상위 래퍼 측정 + 동일값 상태 업데이트 방지
  - [x] 배경 적용 원자 커밋 1차: 성공 시점 일괄 반영/실패 시 상태 유지
  - [x] 전역 최대폭 1440px + 초과 화면 중앙 정렬 적용
  - [x] 전역 최대폭 1440px 정책 해제 + body 회색 배경 제거
  - [x] 페이지 컨테이너 레이아웃 공통화 1차 (`PageContainer` 도입)
  - [x] 공유 섹션 주요 버튼 높이 통일 (`h-11`)
  - [x] 공유 섹션 다운로드 UX 단순화 (`다운로드 클릭형 포맷 드롭다운` + `다운로드/클립보드` 한 줄 배치)
  - [x] 데스크탑 에디터 스타일 리프레시 1차 (`md` 전용 shell/rail/panel/canvas 시각 톤 개선, 모바일 제외)
  - [x] 데스크탑 에디터 스타일 정렬 2차 (non-border 기준 복귀 + 좌측 레일 제거 + 우측 단일 패널 통합)
  - [x] 데스크탑 에디터 스타일 정렬 3차 (캔버스 추가 배경 제거 + 텍스트/도형 버튼 외곽 섹션 제거)
  - [x] 데스크탑 에디터 스타일 정렬 4차 (우측 상단 도구 상태 라벨 제거)
  - [x] 데스크탑 에디터 스타일 정렬 5차 (캔버스 배경 제거 유지 + 우측 편집 패널 배경 복구)
  - [x] 모바일 에디터 디자인 정렬 1차 (툴/히스토리/패널 톤을 데스크탑과 동일 패턴으로 통합)
  - [x] 에디터 이미지 업로드를 캔버스 빈 상태 드롭존으로 이관 + `이미지` 탭 제거
  - [x] 모바일 에디터 패널을 하단 고정 시트에서 인플로우 스크롤 레이아웃으로 복귀
  - [x] 에디터 캔버스 외곽선(border) 제거
  - [x] 다크모드 에디터 배경 토큰 통일(`--editor-canvas-bg` = `--app-surface`)
  - [x] 홈/에디터/밈플릿 목록 루트 배경 토큰 통일(`bg-app-surface`)
  - [x] 전역 프리미티브 스타일 통일 1차(`button/input/textarea/card/dropdown/dialog/sheet`)
  - [x] `/templates` 라이트/다크 카드 hover-only 처리(기본 배경 투명 + hover 시 카드 외곽선 제거, 이미지 주변 배경 유지 제거)
  - [x] `/templates` 상단 정보 블록 제거(타이틀/부제/새로 만들기 버튼)
  - [x] `/templates` 로딩 스켈레톤 톤 정렬(배경/보더 강도 완화 + 단순 pulse surface)
  - [x] 메인 헤더 배경/보더 제거(페이지 배경과 일체형 상단 바)
  - [x] 에디터 Studio Split 1차(데스크탑 3분할 + 모바일 Bottom Sheet 40/80 + 패널 스크롤 정리)
  - [x] 모바일 헤더 햄버거 위치/정렬 보정 + 사이드패널 카드형 UI 개선
  - [x] 색상 토큰 공통화 및 라이트/다크 모드 기반 테마 시스템 도입 (`#92`)
  - [x] `index.css` semantic token(light/dark) 정의 및 전역 적용
  - [x] `App.tsx` Ant Design 토큰을 semantic token으로 연동
  - [x] 다크모드 버튼 밝기 톤다운 1차 (`colorPrimary` 하향 + Button shadow 제거 + 주요 버튼 그림자 정리)
  - [x] 에디터 배경 계층 분리 1차 (`app-surface` 바닥 + `app-surface-elevated` 패널/캔버스 프레임)
  - [x] 다크 에디터 컨트롤 가시성 보강 1차 (툴바/히스토리/레이어 아이콘 버튼 대비 상향)
  - [x] 템플릿 목록/상세 다크 가시성 보강 1차 (`Text secondary` 제거 + 보조 텍스트 대비 상향)
  - [x] 리믹스 진입 에디터 다크 가시성 보강 2차 (패널/캔버스 토큰 분리 + 레이어 아이콘 버튼 크기/보더 강화)
  - [x] 다크모드 전역 색상 규칙 정합화 1차 (`#fff` 제거 + `bg-white` 계열 치환 + 빈상태 가이드 스타일 통일)
  - [x] `EditorGuideCard` 공통 컴포넌트화 (도구선택/업로드/개체없음 가이드 렌더 통일)
  - [x] 공통 레이아웃/헤더/카드 색상 유틸 치환(`slate/blue` 직접 의존 제거)
  - [x] 에디터/캔버스 하드코딩 색상(HEX) 토큰화
  - [x] 라이트/다크 수동 검증 + 스크린샷 비교
  - [x] Tailwind + shadcn/ui 전환 1차 (인프라 도입 + 공통 레이아웃/핵심 페이지 치환)
  - [x] Ant Design 완전 제거 2차 (`Templates`, `TemplateShareDetail`, `ImageShareDetail`, `MyTemplates`, `MemeEditor`, `MemePropertyPanel`, `MemeCanvas`, `useMemeEditor`)
  - [x] 웹 타입체크 경로 보정 + TS 오류 정리 (`build: tsc -b`, `typecheck` 스크립트 추가, `preserveSymlinks` 제거, 캔버스/업로드/nullable 타입 오류 수정)
  - [ ] 전역 스타일 시스템 재정비 (#96)
  - [x] `theme.ts` Ant 잔존 토큰 제거(`AntThemeToken`, `ANT_TOKENS`, `getAntThemeTokens`)
  - [x] `tailwind.config.js` preflight 비활성화 제거
  - [x] `index.css` shadcn base 정합화(`@layer base`, `color-scheme`, radius 토큰)
  - [x] 레이아웃/에디터의 `style={{ var(--...) }}` 인라인 스타일 제거 및 semantic 클래스 치환
  - [x] `ui/alert.tsx`의 `dark:` variant 제거
  - [x] 핵심 동선(`MainHeader`, `HomePage`, `LoginPage`, `MemeEditor`, `MemePropertyPanel`, `MemeCanvas`, `MemeColorPicker`, `EditorGuideCard`, `TemplatesPage`, `ThumbnailCard`, `TemplateThumbnailCard`) `slate/blue` 직접 클래스 제거
  - [x] 상세/마이 페이지(`TemplateShareDetailPage`, `ImageShareDetailPage`, `MyTemplatesPage`, `MyPage`, `MySectionLayout`) `slate/blue` 직접 클래스 semantic alias 2차 치환
  - [x] `apps/web/src`(단, `index.css` 변수명 제외) 클래스 스캔 기준 `slate/blue/on-accent` 직접 클래스 0건 확인
  - [ ] shadcn primitive variant 규칙 재점검(`button/input/card/dropdown/sheet`)
  - [ ] 웹 워커(Web Worker) 기반 내보내기 처리
  - [ ] Undo/Redo 로직 정밀화

## 백엔드 도입 (Fastify) [In Progress]
- [x] **1차 스캐폴딩**
  - [x] `server/` 패키지 초기화 (`Fastify + TS + Zod`)
  - [x] API 진입점 및 라우트 모듈 생성 (`health`, `auth`, `templates`)
  - [x] 환경변수 스키마 및 `.env.example` 추가
  - [x] 루트 스크립트 연결 (`npm run dev:api`, `npm run build:api`)
- [x] **1.1 환경설정/헬스체크 정리**
  - [x] `.env.development` / `.env.production` 분리 로딩 구현
  - [x] `apps/api/.env.development.example`, `apps/api/.env.production.example` 추가
  - [x] `GET /healthz` 엔드포인트 추가
  - [x] 헬스체크 URL 수동 검증 (`/healthz`, `/api/v1/health`)
- [x] **1.2 pnpm 모노레포 전환**
  - [x] 워크스페이스 경로를 `apps/web`, `apps/api`로 재구성
  - [x] 루트 `package.json`을 workspace 오케스트레이터로 전환
  - [x] `pnpm-workspace.yaml` 및 `pnpm-lock.yaml` 추가
  - [x] `package-lock.json` 계열 제거
  - [x] `apps/api/README.md` 경로/실행 명령 갱신
- [x] **1.3 프로덕션 배포 경로 통합**
  - [x] API 서버에서 SPA 정적 서빙(`@fastify/static`) 구현
  - [x] `WEB_DIST_DIR` 환경변수 추가 및 example 반영
  - [x] SPA fallback 라우트(`/* -> index.html`, `/api*` 제외) 구현
  - [x] 프로덕션 모드 수동 검증 (`/`, `/create`, `/api/v1/health`)
- [ ] **2차 인증 구현**
  - [x] Supabase 인증 스키마(SQL) 초안 작성 (`docs/ai-context/sql/2026-02-14_supabase_auth_schema.sql`)
  - [x] Google OAuth start/callback 라우트 구현
  - [x] JWT(access/refresh) 쿠키 발급/검증/회전 구현
  - [x] `POST /api/v1/auth/refresh` API 구현
  - [x] 공통 인증 미들웨어(`requireAuth`) 구현 및 밈플릿 라우트 적용
  - [x] `MainHeader` 로그인/로그아웃 UI 및 세션 상태 표시 연동
  - [x] 우측 상단 사용자 이름 메뉴(마이페이지/내 밈플릿/로그아웃) 연결
  - [x] `마이페이지(/my)` 화면 추가
  - [x] `/my`, `/my/templates` 공통 좌측 사이드 메뉴 레이아웃 적용
  - [x] `/login` 페이지 추가 (Memeplate 로고 + 하단 구글 로그인 버튼)
  - [ ] Supabase SQL 실행 및 초기 데이터 검증
- [ ] **3차 밈플릿 도메인 구현**
  - [x] `TemplateRepository` Supabase 구현체 추가
  - [x] 내 밈플릿 조회/등록/수정/삭제 API 구현
  - [x] 공개 밈플릿 목록 API 구현 (`GET /templates/public`)
  - [x] 공개 목록 지표 필드 응답 추가 (`viewCount`, `likeCount`)
  - [x] 공유 slug 상세 조회 API 구현 (`GET /templates/s/:shareSlug`)
  - [x] 에디터 공유 탭 API 연동(저장/업데이트/공유링크복사)
  - [x] 공개 밈플릿 시작 경로(`shareSlug`)에서 배경 미복원 케이스 fallback 처리(썸네일 기반 background 객체 주입)
  - [x] 공개 밈플릿 시작 시 기본 활성 도구를 `편집`으로 설정
  - [x] 썸네일 payload 최적화(긴 변 `1280px` 리사이즈 + `webp` 품질 압축)
  - [x] 템플릿 목록/관리 전용 화면 구현 (`/templates`, `/my/templates`)
  - [x] `meme_images` 도메인 API 구현 (`/images`, `/images/s/:shareSlug`, `/images/me`, CRUD)
  - [x] `meme_images` 프론트 화면 구현 (`/images`, `/images/s/:shareSlug`, `/my/images`)
  - [x] 밈플릿 상세에서 원본/연관 이미지 2열 레이아웃 적용
  - [x] 연관 이미지 조회용 `templateId` 필터 API 적용
  - [x] 템플릿/리믹스 `description` 입력/조회 지원 및 공유 탭 입력 UI 추가
  - [x] 템플릿/리믹스 `title` 단일라인 검증(줄바꿈 금지) 적용
  - [x] 리믹스 게시 시 `templateId` 필수화 및 미연결 상태 UI 차단
  - [x] 공개 템플릿 시작 경로(`shareSlug`)의 `thumbnailUrl` 기반 배경 fallback 제거 (R2 URL 저장 정책 고정)
  - [x] 템플릿 R2 경로/저장정책 단순화 (`templates` 단일 + 썸네일 별도 업로드 제거)
  - [x] `templates.thumbnail_url` 컬럼 드롭 마이그레이션 추가 + API thumbnail 계산 로직 전환
