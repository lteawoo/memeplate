# 프로젝트 상태 (Status)

## 현재 진행 상황
- [x] 프로젝트 초기화 (Vite + React 19 + TS)
- [x] UI/UX 고도화 (Ant Design 6 + Tailwind CSS 4)
- [x] UI 구조 리팩토링 (완료)
- [x] 모바일 사용성 개선 (Mobile UX)
- [x] Fabric.js 제거 및 자체 엔진 전환 (완료)
- [x] **자체 엔진 고도화 및 텍스트 레이어 개념 정립 (완료)**
- [x] **모바일 레이아웃 개편 (완료 - 이슈 #25)**
- [x] **고정 크기 조절점 구현 (완료 - 이슈 #27)**
- [x] **리사이즈 UX 표준화 (완료)**
  - [x] 코너 핸들 기본 동작을 자유변형으로 전환
  - [x] 엣지 핸들 단일 축 리사이즈 동작 유지
  - [x] 단축키 modifier(`Shift`, `Alt/Option`) 동작은 스펙에서 제외
- [x] **회전 핸들(MTR) 히트 테스트 보정 (완료)**
  - [x] 핸들 렌더 좌표와 클릭 판정 좌표의 `scale` 계산 불일치 수정
- [x] **툴바 컴팩트화 1차 (완료)**
  - [x] `이미지/편집/공유` 섹션 높이 축소 (`h-24 -> h-20`)
  - [x] 버튼 패딩/아이콘 크기/그룹 여백 축소
- [x] **레이어 텍스트 편집 입력폭 확장 (완료)**
  - [x] 텍스트 레이어 아이템을 2단(상단 메타/액션 + 하단 입력)으로 재구성
  - [x] 하단 텍스트 입력칸 `w-full` 적용으로 가로 입력 영역 확장
  - [x] 텍스트 레이어 생성 기본값 제거(빈 레이어 생성)
  - [x] 레이어 입력 placeholder를 `텍스트-{순번}` 형식으로 표시
- [x] **텍스트 더블 클릭 편집 기능 구현 (완료 - 이슈 #29)**
  - [x] Canvas 이벤트 시스템에 dblclick 추가
  - [x] HTML Textarea 기반 편집 UI 구현
  - [x] 텍스트 실시간 동기화 및 편집 상태 관리
  - [x] 화면 배율 역계산 로직 추가
  - [x] 조절점 렌더링 및 클릭 영역 보정
  - [x] 모바일 세로 스택 레이아웃 구현
  - [x] 폴딩 패널 로직 제거 및 스크롤 최적화
- [x] **텍스트 더블클릭 편집 UX 2차 보강 (완료)**
  - [x] 편집 오버레이 대비 강화(대시 보더/적응형 배경/텍스트 그림자/캐럿 색)
  - [x] 편집 모드 폰트 크기 과대 표시 보정(실제 텍스트 박스 fit 기준 동기화)
  - [x] 편집 단축키 보강(`Ctrl/Cmd + Enter` 저장, `Esc` 취소/원복)
  - [x] 레이어 텍스트 입력을 멀티라인 TextArea로 통일(최대 3줄 자동확장)
  - [x] 텍스트 좌상단 이동 후 더블클릭 시 textarea Y축 오프셋 오차 수정(캔버스 실제 오프셋 반영)
  - [x] 텍스트 레이아웃 계산 공통화로 편집/실제 렌더 괴리 축소
- [x] **캔버스 줌 UX(Fit/100%) 및 원본 크기 존중 표시 개선 (완료 - 이슈 #30)**
  - [x] 업로드 이미지의 논리 캔버스 크기를 원본 해상도 기준으로 반영
  - [x] 상단 컨트롤에 `Fit`/`100%` 토글 및 퍼센트 표시 추가
  - [x] `Ctrl/Cmd + 0` 단축키로 Fit 복귀 지원
- [x] **린트 경고 제거 및 lint 통과 복구 (완료 - 이슈 #33)**
  - [x] `useMemeEditor.ts`의 `react-hooks/exhaustive-deps` 경고 제거
  - [x] `useMemeEditor.ts`의 `no-explicit-any` 경고 제거
  - [x] `useMemeEditor.ts`의 `no-unused-vars` 경고 제거
- [x] **텍스트 레이어 렌더 선명도 개선 (완료 - 이슈 #37)**
  - [x] 고배율 표시 시 캔버스 백킹 스토어 렌더 스케일 적용
  - [x] 편집 textarea 스타일을 텍스트 객체 스타일과 동기화
- [x] **줌 UX 고도화 (완료 - 이슈 #39)**
  - [x] `Fit`/`100%` 외 `- / + / 퍼센트 입력` 기반 수동 줌 지원
  - [x] `Ctrl/Cmd + Wheel` 기반 연속 확대/축소 지원
  - [x] `fit/manual` 표시 정책으로 상태 모델 확장
  - [x] 오토 핏 과확대 방지(최대 100% 캡) 적용
  - [x] 오토 핏 가변 상한(비율 밴드 기반) 적용
  - [x] 줌 UI(버튼/퍼센트 입력) 제거 및 Auto Fit 전용 표시 정책으로 단순화
  - [x] `Fit`/`100%` UI 복원 및 기본값 `Fit`으로 회귀
  - [x] 줌 퍼센트 표시 제거 및 `Fit` 순수 화면맞춤(상한 제거)으로 조정
  - [x] 이미지 교체(작업영역 크기 변경) 시 자동 `Fit` 복귀 처리
  - [x] 레이아웃 `min-w-0` 보정으로 `100% -> Fit` 전환 시 대형 이미지에서도 정상 축소 복구
  - [x] `Fit` 크기 계산을 floor 기반으로 보정해 가로/세로 가장자리 클리핑(1px) 방지
- [x] **줌 정책 단순화: `Fit/100%` 제거 + 최대 px 상한 기반 자동 비율 스케일 (완료)**
  - [x] `MemeEditor.tsx`에서 데스크탑/모바일 `Fit`/`100%` 버튼 및 관련 상태 제거
  - [x] `MemeCanvas.tsx`에서 단일 자동 스케일 계산으로 통합
  - [x] 표시 최대 변 길이 상한(`800px`) 적용으로 과도한 확대 제한
- [x] **텍스트 외곽선 UI 단위 전환 및 폰트 비례 렌더 적용 (완료)**
  - [x] 텍스트 스타일 패널의 외곽선 단위를 `px`에서 `강도`로 변경
  - [x] 텍스트 렌더 시 외곽선 두께를 `fontSize` 비례값으로 자동 계산
- [x] **Fastify 기반 API 서버 스캐폴딩 추가 (완료 - 백엔드 1차)**
  - [x] `server/` 독립 패키지 생성 (`Fastify + TypeScript + Zod`)
  - [x] 모듈 구조 분리 (`auth`, `templates`, `health`)
  - [x] 루트 스크립트 연결 (`dev:api`, `build:api`)
  - [x] API 타입 빌드/타입체크 통과
- [x] **백엔드 환경설정 분리 및 헬스체크 URL 확장 (완료 - 백엔드 1.1)**
  - [x] `NODE_ENV` 기반 `.env.development` / `.env.production` 로딩 지원
  - [x] `apps/api/.env.*.example` 밈플릿 파일 추가
  - [x] 루트 헬스체크 URL `GET /healthz` 추가 (`/api/v1/health` 유지)
  - [x] 로컬 기동 후 헬스체크 2개 URL 응답 확인
- [x] **pnpm 모노레포 구조 전환 (완료 - 백엔드/프론트 통합 운영 기반)**
  - [x] 워크스페이스 구조 재배치: `apps/web`, `apps/api`
  - [x] 루트 워크스페이스 설정 추가: `pnpm-workspace.yaml`, `packageManager: pnpm`
  - [x] 루트 스크립트를 workspace filter 기반으로 정리 (`dev`, `dev:web`, `dev:api`, `build`, `lint`)
  - [x] `pnpm dev` 실행 시 web+api 동시 기동으로 변경
  - [x] `npm lock` 제거 및 `pnpm-lock.yaml` 생성
  - [x] `pnpm build`, `pnpm lint`, `pnpm dev` + `/healthz` 응답 검증
- [x] **프로덕션 단일 서버 배포 경로 정리 (완료 - API static SPA 서빙)**
  - [x] `apps/api`에 `@fastify/static` 기반 정적 파일 서빙 추가
  - [x] `NODE_ENV=production`에서 `apps/web/dist`를 API 서버가 직접 서빙
  - [x] `/api/*`, `/healthz` 제외 GET 요청은 `index.html` fallback 처리
  - [x] `NODE_ENV=production pnpm start` 기준 `/`, `/create`, `/api/v1/health` 응답 검증
- [x] **Supabase 인증 DB 스키마 초안 작성 (완료 - OAuth 다중 공급자 대응)**
  - [x] `docs/ai-context/sql/2026-02-14_supabase_auth_schema.sql` 작성
  - [x] `users` / `auth_identities` / `sessions` 스키마 및 인덱스 정의
  - [x] 아바타 미저장 정책 반영
- [x] **밈플릿 공유 MVP 1차 (완료 - 이슈 #62)**
  - [x] `templates` 스키마 SQL 초안 작성 (`docs/ai-context/sql/2026-02-16_templates_share_schema.sql`)
  - [x] Templates Supabase repository 구현 및 API 실동작 전환
  - [x] 공개 밈플릿 목록/공유 slug 조회 API 추가
  - [x] 에디터 공유 탭에서 밈플릿 저장/업데이트/공유 링크 복사 연동
  - [x] R2 업로드 env 스키마 연결 + 썸네일 Data URL 업로드 유틸 추가
- [x] **밈플릿 썸네일 전송 최적화 (완료 - 2026-02-16)**
  - [x] API 본문 제한 `5MB` 기준 유지(`Fastify bodyLimit`)
  - [x] 썸네일 생성 시 긴 변 `1280px` 리사이즈 적용
  - [x] 썸네일 `webp` 품질 압축(`quality=0.82`) 적용
  - [x] 캔버스 export에서 `quality` 옵션 반영하도록 `toDataURL` 보강
- [x] **밈플릿 상세 작성자명 표시 보강 (완료 - 2026-02-16)**
  - [x] 템플릿 API 응답에 `ownerDisplayName` 포함
  - [x] 상세정보 UI에서 `ownerDisplayName -> ownerId` 우선순위로 표기
- [x] **마이페이지 내 정보 수정 기능 추가 (완료 - 2026-02-16)**
  - [x] `PATCH /api/v1/auth/me` 구현 (displayName 수정)
  - [x] `/my`에서 `내 밈플릿 관리` 버튼 제거
  - [x] `/my`에 이름 수정 폼 + 저장 액션 연동
- [x] **밈플릿 목록 카드 UX 개편 (완료 - 2026-02-16)**
  - [x] 카드 액션 버튼 제거 후 카드 전체 클릭으로 상세 진입
  - [x] 목록 카드 메타를 `제목` + `작성자 / 조회수·좋아요` 2줄 구조로 변경
  - [x] `auto-fill + minmax` 기반 가로 가용폭 최대 배치 레이아웃 적용
- [x] **밈플릿 조회/좋아요 필드 추가 (완료 - 2026-02-16)**
  - [x] `templates`에 `view_count`, `like_count` 컬럼 추가 SQL 작성
  - [x] 템플릿 API 응답에 `viewCount`, `likeCount` 매핑 추가
- [x] **밈플릿 상세 조회수 증가 흐름 추가 (완료 - 2026-02-16)**
  - [x] `POST /api/v1/templates/s/:shareSlug/view` API 추가
  - [x] 상세 페이지 진입 시 조회수 증가 API 1회 호출
  - [x] 상세정보에 조회수/좋아요 항목 노출
- [x] **보안/UX 1차 하드닝 (완료 - 2026-02-16)**
  - [x] `@fastify/helmet` 적용 (기본 보안 헤더)
  - [x] `@fastify/rate-limit` 적용 + 인증/조회수 라우트별 제한
  - [x] 이미지 프록시 제거 및 원본 URL 직접 로딩 전환 (`/assets/proxy` 삭제)
  - [x] 밈플릿 목록 로딩 실패 상태를 빈 목록과 분리(재시도 버튼 추가)
- [x] **프론트 상태관리 1차 전환 (완료 - 2026-02-16)**
  - [x] `zustand` 기반 `auth/session` 전역 store 도입 (`user`, `initialized`, `syncSession`, `logout`)
  - [x] `MainHeader`, `MyPage`의 인증 상태 조회 로직을 store 기반으로 통합
  - [x] `@tanstack/react-query` 도입 및 `TemplatesPage`, `MyTemplatesPage` 목록 캐시 전환
- [x] **도메인 분리 설계 1차 (완료 - 2026-02-16)**
  - [x] `templates(소스)` / `meme_images(결과물)` 분리용 SQL 초안 작성
  - [x] `meme_images`에 `template_id`(선택 연결), `share_slug`, `view/like` 지표 포함
- [x] **이미지 도메인 API 1차 구현 (완료 - 2026-02-16)**
  - [x] `GET /images/public`, `GET /images/s/:shareSlug`, `POST /images/s/:shareSlug/view`
  - [x] `GET /images/me`, `GET /images/:imageId`, `POST /images`, `PATCH /images/:imageId`, `DELETE /images/:imageId`
  - [x] `imageDataUrl` 업로드 시 R2 `meme-images/` 경로 저장 지원
- [x] **이미지 도메인 프론트 1차 연결 (완료 - 2026-02-17)**
  - [x] 라우트 추가: `/images`, `/images/s/:shareSlug`, `/my/images`
  - [x] 헤더/마이메뉴에 `템플릿 목록`, `이미지 목록`, `내 이미지` 동선 반영
  - [x] 썸네일 카드 공통화 (`ThumbnailCard`) 및 템플릿/이미지 공용 렌더 적용
  - [x] 비로그인 상태의 `/my/images` 진입 시 메인(`/`) 리다이렉트 검증
- [x] **밈플릿 상세 레이아웃 재구성 (완료 - 2026-02-17)**
  - [x] 좌측 섹션: 원본 밈플릿 + `이 밈플릿 사용하기` 버튼
  - [x] 우측 섹션: 해당 밈플릿 기반 공유 이미지 목록
  - [x] 이미지 목록 API에 `templateId` 필터 추가
- [x] **템플릿/리믹스 설명(description) 및 단일라인 제목 검증 추가 (완료 - 2026-02-17, 이슈 #81)**
  - [x] `templates`, `meme_images`에 `description` 컬럼 추가 SQL 작성
  - [x] 템플릿/리믹스 API 스키마에 `description` 입력 지원
  - [x] 제목(`title`)에 줄바꿈 금지 검증(`\\n`, `\\r` 차단) 적용
  - [x] 공유 탭에 밈플릿/리믹스 설명 입력 UI 추가
  - [x] 밈플릿 상세/리믹스 상세에서 설명 노출(값 존재 시)
- [x] **리믹스 게시 정책 고정: 밈플릿 연결 필수 (완료 - 2026-02-17, 이슈 #83)**
  - [x] `POST /api/v1/images`에서 `templateId` 필수 검증 적용
  - [x] 에디터 공유 탭의 `리믹스 게시` 버튼을 밈플릿 미연결 시 비활성화
  - [x] 리믹스 게시 불가 사유 안내 문구 노출
- [x] **공개 목록 API 쿼리 경량화 1차 (완료 - 2026-02-18)**
  - [x] `templates.listPublic` 작성자명 조회를 `users` 조인 1쿼리로 전환
  - [x] `meme_images.listPublic` 작성자명 조회를 `users` 조인 1쿼리로 전환
- [x] **조회수 증가 원자성 보강 1차 (완료 - 2026-02-18)**
  - [x] DB 함수 `increment_template_view_count`, `increment_meme_image_view_count` SQL 추가
  - [x] 템플릿/리믹스 조회수 증가 로직을 `select -> update`에서 RPC 단일 호출로 전환
- [x] **공유 패널 UX 정합화 1차 (완료 - 2026-02-18)**
  - [x] 공유 탭의 `리믹스 게시` 섹션을 `밈플릿 공유`와 동일한 카드 스타일로 통일
  - [x] 에디터 사이드패널에 `min-h-0` 기반 스크롤 레이아웃 보강으로 항목 넘침 시 스크롤 가능하도록 수정
- [x] **Undo/Redo 스냅샷 저장 부하 완화 1차 (완료 - 2026-02-18)**
  - [x] `useMemeEditor` 히스토리 저장을 즉시/디바운스(`200ms`) 2단계로 분리
  - [x] 빈번한 속성 변경(`updateProperty`)은 디바운스 저장으로 전환
  - [x] 객체 추가/수정/삭제, 텍스트 편집 완료는 즉시 저장 유지
  - [x] 에디터 언마운트 시 디바운스 타이머 정리로 메모리 누수 방지
- [x] **템플릿 배경 저장 R2 URL 전환 1차 (완료 - 2026-02-18)**
  - [x] 템플릿 저장 payload에 `backgroundDataUrl` 필드 추가
  - [x] API에서 `backgroundDataUrl` 업로드 후 `content.objects[].src`를 R2 URL로 치환
  - [x] 프론트 `content` 본문에서 배경 DataURL 제거(빈 src + 서버 치환)
- [x] **공개 템플릿 로드 폴백 제거 (완료 - 2026-02-18)**
  - [x] `/create?shareSlug=...` 로드 시 `thumbnailUrl` 기반 배경 자동주입/빈 src 보정 로직 제거
  - [x] 템플릿 `content.objects[].src`를 Source of Truth로 고정
- [x] **R2 템플릿 자산 정책 단순화 (완료 - 2026-02-18)**
  - [x] 템플릿 배경 업로드 경로를 `templates/{ownerId}/...`로 고정
  - [x] 템플릿 썸네일 별도 업로드 제거
- [x] **템플릿 `thumbnail_url` 컬럼 제거 준비 (완료 - 2026-02-18)**
  - [x] API 조회 응답의 `thumbnailUrl`을 `content.objects[].src`(배경 이미지) 기반 계산으로 전환
  - [x] DB 마이그레이션 SQL 추가 (`2026-02-18_drop_templates_thumbnail_url.sql`)
- [x] **게시 포맷 정책 보정 (완료 - 2026-02-18)**
  - [x] 밈플릿 저장 배경 export를 `webp(quality 0.98)`로 변경
  - [x] 리믹스 게시 `webp` 유지
  - [x] 리믹스 게시 export 배율을 `multiplier 2`로 상향
  - [x] 다운로드 기본 포맷은 `png`로 유지
- [x] **공유 액션 모달화 1차 (완료 - 2026-02-18)**
  - [x] 공유 탭의 인라인 입력폼 제거
  - [x] `밈플릿 게시`, `리믹스 게시`를 각각 모달 입력 플로우로 전환
- [x] **템플릿 업데이트 재인코딩 방지 1차 (완료 - 2026-02-18)**
  - [x] 배경 변경이 없는 메타데이터 업데이트 시 `backgroundDataUrl` 재업로드 스킵
  - [x] 기존 배경 URL을 `content.objects[].src`로 재사용 저장
- [x] **대형 원본 이미지 로드 안정화 1차 (완료 - 2026-02-18)**
  - [x] 업로드 원본의 긴 변이 임계값을 넘으면 작업영역을 비율 유지 축소(`max edge 8192px`)
  - [x] 브라우저 캔버스 한계 초과로 인한 클리핑(잘림) 방지
- [x] **리사이즈 재계산 파이프라인 보정 (완료 - 2026-02-18)**
  - [x] viewport 실측(`clientWidth/clientHeight`) 기반 스케일 재계산으로 통일
  - [x] canvas border 크기를 usable 영역 계산에 반영
  - [x] window resize 이벤트를 추가 구독해 해상도/회전 변경 대응 강화
- [x] **모바일 무한 축소 루프 대응 1차 실험 (롤백 완료 - 2026-02-18)**
  - [x] `h-dvh` + `min-h-0` 기반 실험 적용 후 회귀 발생으로 롤백
- [x] **모바일 회귀 복구 + 업로드 경로 경량화 (완료 - 2026-02-18)**
  - [x] `dvh`/측정기준 분리 변경을 원복해 모바일 스크롤/업로드 회귀 복구
  - [x] 로컬 이미지 업로드를 `dataURL` 대신 `blob URL` 경로로 전환
  - [x] 배경 적용 완료/실패 시 `blob URL` revoke 처리로 메모리 누수 방지
- [x] **모바일 리사이즈 정책 보정 2차 (완료 - 2026-02-19)**
  - [x] 모바일에서는 width-fit 우선 스케일(`viewport width` 기준)로 전환
  - [x] 모바일 `displayHeight`에 `usableViewportHeight` 상한 적용을 제거해 축소 루프 차단
- [x] **전역 레이아웃 최대폭 정책 도입 (완료 - 2026-02-19)**
  - [x] 사이트 루트 최대폭을 `1440px`로 제한
  - [x] 1440px 초과 화면에서 사이트를 중앙 정렬로 표시

## 다음 작업
- [ ] Google OAuth 로그인 엔드포인트 고도화 (`/api/v1/auth/*`)
  - [x] `GET /api/v1/auth/google/start` 구현
  - [x] `GET /api/v1/auth/google/callback` 구현
  - [x] `GET /api/v1/auth/me` 구현
  - [x] `POST /api/v1/auth/refresh` 구현
  - [x] `POST /api/v1/auth/logout` 구현
  - [x] 프론트 로그인 버튼/세션 복구 연동
  - [x] `/login` 전용 화면 분리 및 하단 구글 로그인 CTA 배치
  - [x] 세션 토큰 기반 인증을 JWT(access/refresh) 구조로 전환 (이슈 #53)
  - [x] 인증 미들웨어(`requireAuth`) 공통화 및 밈플릿 라우트 적용
- [ ] Supabase SQL 스키마 실제 반영 및 마이그레이션 실행
- [ ] 템플릿/이미지 IA 2차 정리 (브랜드 `밈플릿` + 도메인 `템플릿/이미지` 문구 통일)
- [ ] 텍스트 레이어 영역 클리핑(Clipping) 처리
- [ ] 레이어 스타일 상세 설정 (그림자, 외곽선 자동색/자동그림자 고도화)
- [ ] 성능 최적화 (Dirty Rect 알고리즘 도입 검토)
- [ ] 단축키(Hotkeys) 지원 확대 (`Ctrl/Cmd + 0` 외 편집 단축키 확장)
- [x] **공개 밈플릿 시작 플로우 안정화 (완료 - 2026-02-16)**
  - [x] `/create?shareSlug=...` 진입 시 background 이미지 객체가 누락된 밈플릿에 대해 `thumbnailUrl` 기반 fallback 배경 객체 자동 주입
  - [x] 밈플릿 로드 완료 시 기본 도구를 `편집`으로 전환해 좌측 패널 `No data` 혼란 상태 최소화
- [x] **마이페이지/사용자 메뉴 정리 (완료 - 2026-02-16)**
  - [x] `/my` 마이페이지 신규 추가
  - [x] 우측 상단 사용자 이름 드롭다운 메뉴 추가 (`마이페이지`, `내 밈플릿`, `로그아웃`)
  - [x] 상단 네비게이션에서 `내 밈플릿` 제거 후 사용자 메뉴로 이동
- [x] **마이 섹션 좌측 사이드 메뉴 도입 (완료 - 2026-02-16)**
  - [x] `MySectionLayout` 공용 레이아웃 추가
  - [x] `/my`, `/my/templates`에 좌측 메뉴(`내 프로필`, `내 밈플릿`) 적용
  - [x] `/my/images` 메뉴 확장
